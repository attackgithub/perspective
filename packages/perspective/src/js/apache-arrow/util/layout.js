// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import * as tslib_1 from "tslib";
import { align } from './bit';
import { TextEncoder } from 'text-encoding-utf-8';
var writeNumeric64Value = writeFixedWidthValue.bind(null, 64);
var writeNumeric128Value = writeFixedWidthValue.bind(null, 128);
var utf8Encoder = new TextEncoder();
var stride1Encode = writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 1));
var stride1FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, stride1Encode));
var stride2FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 2)));
var stride4FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 4)));
export var writeBools = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeBooleanValue), Uint8Array);
export var writeInt8s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int8Array);
export var writeInt16s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int16Array);
export var writeInt32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int32Array);
export var writeInt64s = writeTypedLayout.bind(null, stride2FixedWidth.bind(null, writeNumeric64Value), Int32Array);
export var writeUint8s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint8Array);
export var writeUint16s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint16Array);
export var writeUint32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint32Array);
export var writeUint64s = writeTypedLayout.bind(null, stride2FixedWidth.bind(null, writeNumeric64Value), Uint32Array);
export var writeDecimals = writeTypedLayout.bind(null, stride4FixedWidth.bind(null, writeNumeric128Value), Uint32Array);
export var writeFloat32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Float32Array);
export var writeFloat64s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Float64Array);
export var writeVariableWidth = writeVariableWidthLayout.bind(null, stride1Encode);
export var writeBinary = writeTypedLayout.bind(null, writeVariableWidth.bind(null, writeBinaryValue));
export var writeUtf8s = writeTypedLayout.bind(null, writeVariableWidth.bind(null, writeUtf8Value), Uint8Array);
export var writeDictionaryEncoded = writeDictionaryLayout.bind(null, stride1Encode);
export var writeDictionaryEncodedBools = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeBooleanValue), Uint8Array);
export var writeDictionaryEncodedInt8s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int8Array);
export var writeDictionaryEncodedInt16s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int16Array);
export var writeDictionaryEncodedInt32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int32Array);
export var writeDictionaryEncodedInt64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride2FixedWidth, writeNumeric64Value), Int32Array);
export var writeDictionaryEncodedUint8s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint8Array);
export var writeDictionaryEncodedUint16s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint16Array);
export var writeDictionaryEncodedUint32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint32Array);
export var writeDictionaryEncodedUint64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride2FixedWidth, writeNumeric64Value), Uint32Array);
export var writeDictionaryEncodedDecimals = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride4FixedWidth, writeNumeric128Value), Uint32Array);
export var writeDictionaryEncodedFloat32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Float32Array);
export var writeDictionaryEncodedFloat64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Float64Array);
export var writeDictionaryEncodedVariableWidth = writeDictionaryLayout.bind(null, writeVariableWidth);
export var writeDictionaryEncodedBinary = writeTypedLayout.bind(null, writeDictionaryEncodedVariableWidth.bind(null, writeBinaryValue));
export var writeDictionaryEncodedUtf8s = writeTypedLayout.bind(null, writeDictionaryEncodedVariableWidth.bind(null, writeUtf8Value), Uint8Array);
function writeFixedWidthLayoutWithStride(stride, writeValue, values) {
    var index = -stride;
    var data = [];
    var length = values.length;
    while ((index += stride) < length) {
        writeValue(values, data, index);
    }
    return { data: data };
}
function writeFixedWidthLayout(writeLayout, writeValue, values, nulls) {
    return writeLayout(writeValue, values, nulls);
}
function writeValidityLayout(writeLayout, writeValue, values, nulls) {
    var nullCount = 0;
    var nullsLength = nulls && nulls.length || 0;
    var validity = new Uint8Array(align(values.length >>> 3, 8)).fill(255);
    return tslib_1.__assign({}, writeLayout(writeValueOrValidity, values), { nullCount: nullCount, validity: (nullCount > 0 && validity) || new Uint8Array(0) });
    function writeValueOrValidity(src, dst, index) {
        writeValue(src, dst, index);
        var i = -1, x = src[index];
        var isNull = x === null || x === undefined;
        while (!isNull && ++i < nullsLength) {
            isNull = x === nulls[i];
        }
        if (isNull) {
            nullCount++;
            validity[index >> 3] &= ~(1 << (index % 8));
        }
    }
}
function writeVariableWidthLayout(writeLayout, writeValue, values, nulls) {
    var offsets = [0], offsetsIndex = 0;
    return tslib_1.__assign({}, writeLayout(writeValueAndOffset, values, nulls), { offsets: offsets });
    function writeValueAndOffset(src, dst, index) {
        if (!writeValue(src, dst, index)) {
            offsets[++offsetsIndex] = dst.length;
        }
    }
}
function writeDictionaryLayout(writeLayout, writeValue, values, nulls) {
    var keys = [], keysIndex = 0, keysMap = Object.create(null);
    return tslib_1.__assign({}, writeLayout(writeKeysOrValues, values, nulls), { keys: keys });
    function writeKeysOrValues(src, dst, index) {
        var x = src[index];
        if (x in keysMap) {
            return (keys[index] = keysMap[x]) || true;
        }
        else if (!writeValue(src, dst, index)) {
            keys[index] = keysMap[x] = keysIndex++;
        }
    }
}
function writeTypedLayout(writeBuffers, ArrayBufferView, values, nulls) {
    var result = writeBuffers(values, nulls);
    result.data = new ArrayBufferView(result.data);
    return result;
}
function writeBooleanValue(src, dst, index) {
    if (src[index]) {
        var i = index >>> 3;
        var b = dst[i] || 0;
        dst[i] = b | 1 << (index % 8);
    }
}
function writeNumericValue(src, dst, index) {
    dst[index] = +src[index];
}
function writeFixedWidthValue(bitWidth, src, dst, index) {
    var bytesLen = bitWidth / 32;
    for (var i = -1; ++i < bytesLen;) {
        dst[index + i] = src[index + i];
    }
}
function writeUtf8Value(src, dst, index) {
    dst.push.apply(dst, tslib_1.__spread(utf8Encoder.encode(src[index])));
}
function writeBinaryValue(src, dst, index) {
    dst.push.apply(dst, tslib_1.__spread(src[index]));
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QixRQUFnQixFQUFFLEdBQXNCLEVBQUUsR0FBYSxFQUFFLEtBQWE7SUFDaEcsSUFBTSxRQUFRLEdBQUcsUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUMvQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxRQUFRLEdBQUcsQ0FBQztRQUMvQixHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDcEMsQ0FBQztBQUNMLENBQUM7QUFFRCx3QkFBd0IsR0FBc0IsRUFBRSxHQUFhLEVBQUUsS0FBYTtJQUN4RSxHQUFHLENBQUMsSUFBSSxPQUFSLEdBQUcsbUJBQVMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRTtBQUNoRCxDQUFDO0FBRUQsMEJBQTBCLEdBQWdDLEVBQUUsR0FBYSxFQUFFLEtBQWE7SUFDcEYsR0FBRyxDQUFDLElBQUksT0FBUixHQUFHLG1CQUFTLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRTtBQUM1QixDQUFDIiwiZmlsZSI6InV0aWwvbGF5b3V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IGFsaWduIH0gZnJvbSAnLi9iaXQnO1xuaW1wb3J0IHsgVGV4dEVuY29kZXIgfSBmcm9tICd0ZXh0LWVuY29kaW5nLXV0Zi04JztcbmltcG9ydCB7IFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgVHlwZWRBcnJheSB9IGZyb20gJy4uL3R5cGUnO1xuXG5leHBvcnQgdHlwZSBOdWxsYWJsZUxheW91dCA9IHsgbnVsbENvdW50OiBudW1iZXIsIHZhbGlkaXR5OiBVaW50OEFycmF5IH07XG5leHBvcnQgdHlwZSBCdWZmZXJMYXlvdXQ8VEFycmF5ID0gQXJyYXlMaWtlPG51bWJlcj4+ID0geyBkYXRhOiBUQXJyYXkgfTtcbmV4cG9ydCB0eXBlIERpY3Rpb25hcnlMYXlvdXQ8VEFycmF5ID0gQXJyYXlMaWtlPG51bWJlcj4+ID0geyBkYXRhOiBUQXJyYXksIGtleXM6IG51bWJlcltdIH07XG5leHBvcnQgdHlwZSBWYXJpYWJsZVdpZHRoTGF5b3V0PFRBcnJheSA9IEFycmF5TGlrZTxudW1iZXI+PiA9IHsgZGF0YTogVEFycmF5LCBvZmZzZXRzOiBudW1iZXJbXSB9O1xuZXhwb3J0IHR5cGUgVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VEFycmF5ID0gQXJyYXlMaWtlPG51bWJlcj4+ID0geyBkYXRhOiBUQXJyYXksIGtleXM6IG51bWJlcltdLCBvZmZzZXRzOiBudW1iZXJbXSB9O1xuXG5leHBvcnQgdHlwZSB2YWx1ZXM8VCwgVE51bGw+ID0gQXJyYXlMaWtlPFQgfCBUTnVsbCB8IG51bGwgfCB1bmRlZmluZWQ+O1xuZXhwb3J0IHR5cGUgQnVmZmVyVmFsdWVXcml0ZXI8VD4gPSAoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpID0+IGJvb2xlYW4gfCB2b2lkO1xuZXhwb3J0IHR5cGUgQnVmZmVyV3JpdGVyPFQsIFROdWxsPiA9ICh2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0O1xuZXhwb3J0IHR5cGUgQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPiA9ICh3cml0ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ7XG5cbmNvbnN0IHdyaXRlTnVtZXJpYzY0VmFsdWUgPSB3cml0ZUZpeGVkV2lkdGhWYWx1ZS5iaW5kKG51bGwsIDY0KTtcbmNvbnN0IHdyaXRlTnVtZXJpYzEyOFZhbHVlID0gd3JpdGVGaXhlZFdpZHRoVmFsdWUuYmluZChudWxsLCAxMjgpO1xuY29uc3QgdXRmOEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKSBhcyB7IGVuY29kZTogKHM6IHN0cmluZykgPT4gVWludDhBcnJheSB9O1xuXG5jb25zdCBzdHJpZGUxRW5jb2RlID0gd3JpdGVWYWxpZGl0eUxheW91dC5iaW5kKG51bGwsIHdyaXRlRml4ZWRXaWR0aExheW91dFdpdGhTdHJpZGUuYmluZChudWxsLCAxKSk7XG5jb25zdCBzdHJpZGUxRml4ZWRXaWR0aCA9IHdyaXRlRml4ZWRXaWR0aExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFsaWRpdHlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRW5jb2RlKSk7XG5jb25zdCBzdHJpZGUyRml4ZWRXaWR0aCA9IHdyaXRlRml4ZWRXaWR0aExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFsaWRpdHlMYXlvdXQuYmluZChudWxsLCB3cml0ZUZpeGVkV2lkdGhMYXlvdXRXaXRoU3RyaWRlLmJpbmQobnVsbCwgMikpKTtcbmNvbnN0IHN0cmlkZTRGaXhlZFdpZHRoID0gd3JpdGVGaXhlZFdpZHRoTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVWYWxpZGl0eUxheW91dC5iaW5kKG51bGwsIHdyaXRlRml4ZWRXaWR0aExheW91dFdpdGhTdHJpZGUuYmluZChudWxsLCA0KSkpO1xuXG5leHBvcnQgY29uc3Qgd3JpdGVCb29scyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlQm9vbGVhblZhbHVlKSwgVWludDhBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPGJvb2xlYW4gfCBudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVJbnQ4cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50OEFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxJbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlSW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBJbnQxNkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8SW50MTZBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVJbnQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWNWYWx1ZSksIEludDMyQXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxJbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZUludDY0cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUyRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBJbnQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0PEludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlVWludDhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50OEFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVaW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MTZBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MTZBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVaW50MzJzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MzJBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVaW50NjRzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTJGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljNjRWYWx1ZSksIFVpbnQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEZWNpbWFscyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGU0Rml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpYzEyOFZhbHVlKSwgVWludDMyQXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVGbG9hdDMycyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgRmxvYXQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxGbG9hdDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRmxvYXQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWNWYWx1ZSksIEZsb2F0NjRBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8RmxvYXQ2NEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZVZhcmlhYmxlV2lkdGggPSB3cml0ZVZhcmlhYmxlV2lkdGhMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRW5jb2RlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxULCBUTnVsbD4od3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBWYXJpYWJsZVdpZHRoTGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlQmluYXJ5ID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFyaWFibGVXaWR0aC5iaW5kKG51bGwsIHdyaXRlQmluYXJ5VmFsdWUpKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxJdGVyYWJsZTxudW1iZXI+LCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aExheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZVV0ZjhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFyaWFibGVXaWR0aC5iaW5kKG51bGwsIHdyaXRlVXRmOFZhbHVlKSwgVWludDhBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8c3RyaW5nLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aExheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkID0gd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUVuY29kZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxULCBUTnVsbD4od3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRCb29scyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVCb29sZWFuVmFsdWUpLCBVaW50OEFycmF5KSAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxib29sZWFuIHwgbnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkSW50OHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50OEFycmF5KSAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxJbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRJbnQxNnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50MTZBcnJheSkgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEludDE2QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRJbnQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50MzJBcnJheSkgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRJbnQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMkZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBJbnQzMkFycmF5KSAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRVaW50OHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgVWludDhBcnJheSkgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRVaW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIFVpbnQxNkFycmF5KSAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQxNkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVWludDMycyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MzJBcnJheSkgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFVpbnQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMkZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBVaW50MzJBcnJheSkgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IERpY3Rpb25hcnlMYXlvdXQ8VWludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWREZWNpbWFscyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGU0Rml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljMTI4VmFsdWUpLCBVaW50MzJBcnJheSkgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkRmxvYXQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgRmxvYXQzMkFycmF5KSAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxGbG9hdDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRGbG9hdDY0cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljVmFsdWUpLCBGbG9hdDY0QXJyYXkpICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEZsb2F0NjRBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFZhcmlhYmxlV2lkdGggPSB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCB3cml0ZVZhcmlhYmxlV2lkdGgpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VCwgVE51bGw+KHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LCB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZEJpbmFyeSA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVmFyaWFibGVXaWR0aC5iaW5kKG51bGwsIHdyaXRlQmluYXJ5VmFsdWUpKSAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPEl0ZXJhYmxlPG51bWJlcj4sIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBWYXJpYWJsZVdpZHRoRGljdGlvbmFyeUxheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVXRmOHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFZhcmlhYmxlV2lkdGguYmluZChudWxsLCB3cml0ZVV0ZjhWYWx1ZSksIFVpbnQ4QXJyYXkpICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8c3RyaW5nLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VWludDhBcnJheT47XG5cbmZ1bmN0aW9uIHdyaXRlRml4ZWRXaWR0aExheW91dFdpdGhTdHJpZGU8VCwgVE51bGw+KFxuICAgIHN0cmlkZTogbnVtYmVyLFxuICAgIHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LFxuICAgIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPlxuKSB7XG4gICAgbGV0IGluZGV4ID0gLXN0cmlkZTtcbiAgICBjb25zdCBkYXRhID0gW10gYXMgbnVtYmVyW107XG4gICAgY29uc3QgbGVuZ3RoID0gdmFsdWVzLmxlbmd0aDtcbiAgICB3aGlsZSAoKGluZGV4ICs9IHN0cmlkZSkgPCBsZW5ndGgpIHtcbiAgICAgICAgd3JpdGVWYWx1ZSh2YWx1ZXMgYXMgQXJyYXlMaWtlPFQ+LCBkYXRhLCBpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiB7IGRhdGE6IGRhdGEgYXMgQXJyYXlMaWtlPG51bWJlcj4gfTtcbn1cblxuZnVuY3Rpb24gd3JpdGVGaXhlZFdpZHRoTGF5b3V0PFQsIFROdWxsPihcbiAgICB3cml0ZUxheW91dDogQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPixcbiAgICB3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPixcbiAgICB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sXG4gICAgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+XG4pIHtcbiAgICByZXR1cm4gd3JpdGVMYXlvdXQod3JpdGVWYWx1ZSwgdmFsdWVzLCBudWxscyk7XG59XG5cbmZ1bmN0aW9uIHdyaXRlVmFsaWRpdHlMYXlvdXQ8VCwgVE51bGw+KFxuICAgIHdyaXRlTGF5b3V0OiBCdWZmZXJMYXlvdXRXcml0ZXI8VCwgVE51bGw+LFxuICAgIHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LFxuICAgIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPixcbiAgICBudWxscz86IEFycmF5TGlrZTxUTnVsbD5cbikge1xuICAgIGxldCBudWxsQ291bnQgPSAwO1xuICAgIGxldCBudWxsc0xlbmd0aCA9IG51bGxzICYmIG51bGxzLmxlbmd0aCB8fCAwO1xuICAgIGxldCB2YWxpZGl0eSA9IG5ldyBVaW50OEFycmF5KGFsaWduKHZhbHVlcy5sZW5ndGggPj4+IDMsIDgpKS5maWxsKDI1NSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4ud3JpdGVMYXlvdXQod3JpdGVWYWx1ZU9yVmFsaWRpdHksIHZhbHVlcyksXG4gICAgICAgIG51bGxDb3VudCwgdmFsaWRpdHk6IChudWxsQ291bnQgPiAwICYmIHZhbGlkaXR5KSB8fCBuZXcgVWludDhBcnJheSgwKVxuICAgIH0gYXMgQnVmZmVyTGF5b3V0ICYgTnVsbGFibGVMYXlvdXQ7XG4gICAgZnVuY3Rpb24gd3JpdGVWYWx1ZU9yVmFsaWRpdHkoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgd3JpdGVWYWx1ZShzcmMsIGRzdCwgaW5kZXgpO1xuICAgICAgICBsZXQgaSA9IC0xLCB4ID0gc3JjW2luZGV4XSBhcyBUIHwgVE51bGw7XG4gICAgICAgIGxldCBpc051bGwgPSB4ID09PSBudWxsIHx8IHggPT09IHVuZGVmaW5lZDtcbiAgICAgICAgd2hpbGUgKCFpc051bGwgJiYgKytpIDwgbnVsbHNMZW5ndGgpIHtcbiAgICAgICAgICAgIGlzTnVsbCA9IHggPT09IG51bGxzIVtpXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNOdWxsKSB7XG4gICAgICAgICAgICBudWxsQ291bnQrKztcbiAgICAgICAgICAgIHZhbGlkaXR5W2luZGV4ID4+IDNdICY9IH4oMSA8PCAoaW5kZXggJSA4KSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlVmFyaWFibGVXaWR0aExheW91dDxULCBUTnVsbD4oXG4gICAgd3JpdGVMYXlvdXQ6IEJ1ZmZlckxheW91dFdyaXRlcjxULCBUTnVsbD4sXG4gICAgd3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sXG4gICAgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LFxuICAgIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPlxuKSB7XG4gICAgbGV0IG9mZnNldHMgPSBbMF0sIG9mZnNldHNJbmRleCA9IDA7XG4gICAgcmV0dXJuIHsgLi4ud3JpdGVMYXlvdXQod3JpdGVWYWx1ZUFuZE9mZnNldCwgdmFsdWVzLCBudWxscyksIG9mZnNldHMgfSBhcyBWYXJpYWJsZVdpZHRoTGF5b3V0O1xuICAgIGZ1bmN0aW9uIHdyaXRlVmFsdWVBbmRPZmZzZXQoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgaWYgKCF3cml0ZVZhbHVlKHNyYywgZHN0LCBpbmRleCkpIHtcbiAgICAgICAgICAgIG9mZnNldHNbKytvZmZzZXRzSW5kZXhdID0gZHN0Lmxlbmd0aDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVEaWN0aW9uYXJ5TGF5b3V0PFQsIFROdWxsPihcbiAgICB3cml0ZUxheW91dDogQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPixcbiAgICB3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPixcbiAgICB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sXG4gICAgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+XG4pIHtcbiAgICBsZXQga2V5cyA9IFtdIGFzIG51bWJlcltdLCBrZXlzSW5kZXggPSAwLCBrZXlzTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICByZXR1cm4geyAuLi53cml0ZUxheW91dCh3cml0ZUtleXNPclZhbHVlcywgdmFsdWVzLCBudWxscyksIGtleXMgfTtcbiAgICBmdW5jdGlvbiB3cml0ZUtleXNPclZhbHVlcyhzcmM6IEFycmF5TGlrZTxUPiwgZHN0OiBudW1iZXJbXSwgaW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCB4OiBhbnkgPSBzcmNbaW5kZXhdO1xuICAgICAgICBpZiAoeCBpbiBrZXlzTWFwKSB7XG4gICAgICAgICAgICByZXR1cm4gKGtleXNbaW5kZXhdID0ga2V5c01hcFt4XSkgfHwgdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmICghd3JpdGVWYWx1ZShzcmMsIGRzdCwgaW5kZXgpKSB7XG4gICAgICAgICAgICBrZXlzW2luZGV4XSA9IGtleXNNYXBbeF0gPSBrZXlzSW5kZXgrKztcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVUeXBlZExheW91dDxULCBUTnVsbCwgVEFycmF5IGV4dGVuZHMgVHlwZWRBcnJheT4oXG4gICAgd3JpdGVCdWZmZXJzOiBCdWZmZXJXcml0ZXI8VCwgVE51bGw+LFxuICAgIEFycmF5QnVmZmVyVmlldzogVHlwZWRBcnJheUNvbnN0cnVjdG9yPFRBcnJheT4sXG4gICAgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LFxuICAgIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPlxuKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gd3JpdGVCdWZmZXJzKHZhbHVlcywgbnVsbHMpO1xuICAgIHJlc3VsdC5kYXRhID0gbmV3IEFycmF5QnVmZmVyVmlldyhyZXN1bHQuZGF0YSk7XG4gICAgcmV0dXJuIHJlc3VsdCBhcyBCdWZmZXJMYXlvdXQ8VEFycmF5Pjtcbn1cblxuZnVuY3Rpb24gd3JpdGVCb29sZWFuVmFsdWUoc3JjOiBBcnJheUxpa2U8Ym9vbGVhbj4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAoc3JjW2luZGV4XSkge1xuICAgICAgICBsZXQgaSA9IGluZGV4ID4+PiAzO1xuICAgICAgICBsZXQgYiA9IGRzdFtpXSB8fCAwO1xuICAgICAgICBkc3RbaV0gPSBiIHwgMSA8PCAoaW5kZXggJSA4KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlTnVtZXJpY1ZhbHVlKHNyYzogQXJyYXlMaWtlPG51bWJlcj4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBkc3RbaW5kZXhdID0gK3NyY1tpbmRleF07XG59XG5cbmZ1bmN0aW9uIHdyaXRlRml4ZWRXaWR0aFZhbHVlKGJpdFdpZHRoOiBudW1iZXIsIHNyYzogQXJyYXlMaWtlPG51bWJlcj4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBieXRlc0xlbiA9IGJpdFdpZHRoIC8gMzI7XG4gICAgZm9yIChsZXQgaSA9IC0xOyArK2kgPCBieXRlc0xlbjspIHtcbiAgICAgICAgZHN0W2luZGV4ICsgaV0gPSBzcmNbaW5kZXggKyBpXTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlVXRmOFZhbHVlKHNyYzogQXJyYXlMaWtlPHN0cmluZz4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBkc3QucHVzaCguLi51dGY4RW5jb2Rlci5lbmNvZGUoc3JjW2luZGV4XSkpO1xufVxuXG5mdW5jdGlvbiB3cml0ZUJpbmFyeVZhbHVlKHNyYzogQXJyYXlMaWtlPEl0ZXJhYmxlPG51bWJlcj4+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgZHN0LnB1c2goLi4uc3JjW2luZGV4XSk7XG59XG4iXX0=
